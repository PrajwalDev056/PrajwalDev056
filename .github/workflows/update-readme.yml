name: Update README with latest repos

on:
  schedule:
    - cron: "0 * * * *" # Runs every hour
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fetch latest repos and update README
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const username = 'PrajwalDev056';
            const { data: repos } = await github.rest.repos.listForUser({
              username,
              sort: 'updated',
              per_page: 5,
            });
            const list = repos.map(r => `- [${r.name}](${r.html_url})`).join('\\n');
            const fs = require('fs');
            let readme = fs.readFileSync('README.md', 'utf8');
            readme = readme.replace(
              /<!--START_SECTION:recent_repos-->[\\s\\S]*<!--END_SECTION:recent_repos-->/,
              `<!--START_SECTION:recent_repos-->\\n${list}\\n<!--END_SECTION:recent_repos-->`
            );
            fs.writeFileSync('README.md', readme);
      - name: Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add README.md
          git diff --cached --quiet || git commit -m "Update recent repos in README"
          git push
